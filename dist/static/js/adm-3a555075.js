import{d as e,r as l,Q as a,e as t,l as o,R as d,m as r,v as i,c as s,w as u,s as n,F as m,S as p,n as f,T as c,U as b,V as g,x as h,a as _,W as v,X as w,L as V,Y as y,Z as U}from"./index-73e8d8c6.js";import{p as x}from"./commonUtil-08d6684d.js";import{P as k}from"./index-4ffd8671.js";const C=_("查询"),P=_("新增"),z=_("编辑"),S=_("删除"),j={class:"dialog-footer"},q=_("取消"),E=_("提交"),L=e({name:"PermissionAdm"}),I=Object.assign(L,{setup(e){const _=l({loading:!0,search:"",datetime:null,list:[],showList:[],currentPage:1,pageSize:15}),L=()=>{_.loading=!0,v({search:_.search,role:"all"===A.value?"":A.value,t1:_.datetime?x(_.datetime[0]):"",t2:_.datetime?x(_.datetime[1]):""}).then((e=>{_.list=e.data?e.data:[],I(!0),_.loading=!1})).catch((()=>{_.loading=!1}))};let I=(e=!1)=>{e&&(_.currentPage=1),_.showList=_.list.slice((_.currentPage-1)*_.pageSize,_.currentPage*_.pageSize)},A=l({value:"all",list:[]});a().then((e=>{A.list=e.data})).catch((()=>{}));const D=t(null),F=l({visible:!1,loading:!1,form:{id:""},rules:{user_name:[{required:!0,validator:(e,l,a)=>{""===l?a(new Error("用户名为必填字段")):/^.{5,30}$/.test(l)?a():a(new Error("用户名长度必须至少为5个字符"))},trigger:"blue"}],password:[{required:!0,validator:(e,l,a)=>{F.form.id||""!==l?F.form.id||/^.{6,}$/.test(l)?a():a(new Error("密码长度必须至少为6个字符")):a(new Error("密码为必填字段"))},trigger:"blue"}],role:[{required:!0,message:"请选择",trigger:"change"}],status:[{required:!0,message:"请选择",trigger:"change"}]}}),$=()=>{F.form={user_name:"",password:"",role:"",pid:"",status:1},F.visible=!0,F.loading=!1,V((()=>{D.value.clearValidate()}))},O=()=>{D.value.validate((e=>{if(!e)return!1;F.loading=!0,F.form.id?w({id:F.form.id,password:F.form.password,role:F.form.role,pid:F.form.pid,status:F.form.status}).then((()=>{F.visible=!1,L()})).catch((()=>{F.loading=!1})):y({user_name:F.form.user_name,password:F.form.password,role:F.form.role,pid:F.form.pid,status:F.form.status}).then((()=>{F.visible=!1,L()})).catch((()=>{F.loading=!1}))}))};return L(),(e,l)=>{const a=o("el-input"),t=o("el-form-item"),v=o("el-option"),y=o("el-select"),x=o("el-date-picker"),Q=o("el-button"),R=o("el-form"),T=o("el-table-column"),W=o("el-switch"),X=o("el-popconfirm"),Y=o("el-table"),Z=o("el-dialog"),B=d("loading");return r(),i("div",null,[s(R,{inline:!0},{default:u((()=>[s(t,{label:"用户名"},{default:u((()=>[s(a,{modelValue:_.search,"onUpdate:modelValue":l[0]||(l[0]=e=>_.search=e),placeholder:"支持模糊查询",clearable:"",style:{width:"120px"}},null,8,["modelValue"])])),_:1}),s(t,{label:"角色"},{default:u((()=>[s(y,{modelValue:n(A).value,"onUpdate:modelValue":l[1]||(l[1]=e=>n(A).value=e),placeholder:"请选择",style:{width:"120px"},filterable:"",clearable:""},{default:u((()=>[s(v,{label:"全部",value:"all"}),(r(!0),i(m,null,p(n(A).list,(e=>(r(),f(v,{key:e.id,label:e.role_name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(t,{label:"登录时间"},{default:u((()=>[s(x,{modelValue:_.datetime,"onUpdate:modelValue":l[2]||(l[2]=e=>_.datetime=e),type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间",clearable:"",style:{width:"380px"}},null,8,["modelValue"])])),_:1}),s(t,null,{default:u((()=>[s(Q,{type:"primary",icon:n(c),onClick:L},{default:u((()=>[C])),_:1},8,["icon"]),s(Q,{type:"success",icon:n(b),onClick:$},{default:u((()=>[P])),_:1},8,["icon"])])),_:1})])),_:1}),g((r(),f(Y,{data:_.showList,border:"",style:{width:"100%"}},{default:u((()=>[s(T,{prop:"id",label:"ID"}),s(T,{prop:"user_name",label:"用户名"}),s(T,{prop:"role_name",label:"角色"}),s(T,{prop:"pid",label:"上级ID"}),s(T,{prop:"last_login_ip",label:"最后登陆IP","min-width":"135"}),s(T,{prop:"created_at",label:"创建时间","min-width":"165"}),s(T,{prop:"updated_at",label:"更新时间","min-width":"165"}),s(T,{prop:"last_login_time",label:"最后登陆时间","min-width":"165"}),s(T,{label:"状态"},{default:u((({row:e})=>[s(W,{modelValue:e.status,"onUpdate:modelValue":l=>e.status=l,"inline-prompt":"","active-text":"正常","inactive-text":"禁用","active-value":1,"inactive-value":0,onChange:l=>(e=>{w({id:e.id,status:e.status}).then((()=>{})).catch((()=>{e.status=1===e.status?0:1}))})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),s(T,{label:"操作",fixed:"right",width:"140"},{default:u((({row:e})=>[s(Q,{type:"primary",size:"small",onClick:l=>(e=>{F.form={id:e.id,user_name:e.user_name,password:"",role:e.role,pid:0===e.pid?"":e.pid,status:e.status},F.visible=!0,F.loading=!1,V((()=>{D.value.clearValidate()}))})(e)},{default:u((()=>[z])),_:2},1032,["onClick"]),s(X,{title:"确定删除吗?",onConfirm:l=>{return a=e.id,_.loading=!0,void U({id:a}).then((()=>{})).catch((()=>{})).finally((()=>{L()}));var a}},{reference:u((()=>[s(Q,{type:"danger",size:"small"},{default:u((()=>[S])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[B,_.loading]]),s(k,{page:_.currentPage,"onUpdate:page":l[3]||(l[3]=e=>_.currentPage=e),limit:_.pageSize,"onUpdate:limit":l[4]||(l[4]=e=>_.pageSize=e),total:_.list.length,onPagination:l[5]||(l[5]=e=>n(I)())},null,8,["page","limit","total"]),s(Z,{modelValue:F.visible,"onUpdate:modelValue":l[12]||(l[12]=e=>F.visible=e),title:F.form.id?"编辑用户":"新增用户",width:"340px"},{footer:u((()=>[h("span",j,[s(Q,{onClick:l[11]||(l[11]=e=>F.visible=!1)},{default:u((()=>[q])),_:1}),s(Q,{type:"primary",loading:F.loading,onClick:O},{default:u((()=>[E])),_:1},8,["loading"])])])),default:u((()=>[s(R,{ref_key:"refAccountForm",ref:D,model:F.form,rules:F.rules,"label-width":"80px"},{default:u((()=>[s(t,{label:"用户名",prop:"user_name"},{default:u((()=>[s(a,{modelValue:F.form.user_name,"onUpdate:modelValue":l[6]||(l[6]=e=>F.form.user_name=e),placeholder:"5~30位字符",disabled:F.form.id,style:{width:"200px"}},null,8,["modelValue","disabled"])])),_:1}),s(t,{label:"密码",prop:"password"},{default:u((()=>[s(a,{modelValue:F.form.password,"onUpdate:modelValue":l[7]||(l[7]=e=>F.form.password=e),type:"password",placeholder:"不小于6位数",style:{width:"200px"}},null,8,["modelValue"])])),_:1}),s(t,{label:"角色",prop:"role"},{default:u((()=>[s(y,{modelValue:F.form.role,"onUpdate:modelValue":l[8]||(l[8]=e=>F.form.role=e),placeholder:"请选择",filterable:"",clearable:""},{default:u((()=>[(r(!0),i(m,null,p(n(A).list,(e=>(r(),f(v,{key:e.id,label:e.role_name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(t,{label:"上级"},{default:u((()=>[s(y,{modelValue:F.form.pid,"onUpdate:modelValue":l[9]||(l[9]=e=>F.form.pid=e),placeholder:"请选择",filterable:"",clearable:""},{default:u((()=>[(r(!0),i(m,null,p(_.list,(e=>(r(),f(v,{key:e.id,label:e.user_name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(t,{label:"状态",prop:"status"},{default:u((()=>[s(y,{modelValue:F.form.status,"onUpdate:modelValue":l[10]||(l[10]=e=>F.form.status=e),placeholder:"请选择",filterable:"",clearable:""},{default:u((()=>[s(v,{label:"启用",value:1}),s(v,{label:"禁用",value:0})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}});export{I as default};
